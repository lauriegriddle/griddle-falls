<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Griddle Falls - Sunday Trivia Night</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(180deg, #C2632A 0%, #D4833A 25%, #E8A866 50%, #F5DEB3 80%, #FFFDF5 100%);
      min-height: 100vh;
      color: #5D4E37;
      overflow-x: hidden;
    }

    /* Rain effect */
    .rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      opacity: 0.3;
    }

    .rain-drop {
      position: absolute;
      width: 2px;
      height: 20px;
      background: linear-gradient(transparent, rgba(255,255,255,0.3));
      animation: rain-fall linear infinite;
    }

    @keyframes rain-fall {
      0% { transform: translateY(-100px); }
      100% { transform: translateY(100vh); }
    }

    /* Window glow effect */
    .window-glow {
      position: fixed;
      top: 20px;
      right: 40px;
      width: 120px;
      height: 80px;
      background: radial-gradient(ellipse, rgba(255, 183, 77, 0.15) 0%, transparent 70%);
      border-radius: 4px;
      z-index: 0;
    }

    .window-glow::before {
      content: '';
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      bottom: 10px;
      border: 2px solid rgba(255, 183, 77, 0.2);
      border-radius: 2px;
    }

    /* Main container */
    .container {
      position: relative;
      z-index: 1;
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo {
      width: 70px;
      height: 70px;
      margin: 0 auto 10px;
    }

    .title {
      font-size: 32px;
      color: #d4a574;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 5px;
    }

    .subtitle {
      font-size: 14px;
      color: #a89080;
      font-style: italic;
    }

    /* Timer and progress */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: rgba(45, 36, 28, 0.8);
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid rgba(212, 165, 116, 0.2);
    }

    .timer-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .cafe-time {
      font-size: 11px;
      color: #7a6a5a;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 2px;
    }

    .timer {
      font-size: 24px;
      color: #ffb74d;
      font-family: 'Courier New', monospace;
    }

    .progress {
      font-size: 16px;
      color: #a89080;
    }

    .progress-dots {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(212, 165, 116, 0.3);
      transition: all 0.3s ease;
    }

    .dot.completed {
      background: #4caf50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
    }

    .dot.current {
      background: #ffb74d;
      box-shadow: 0 0 8px rgba(255, 183, 77, 0.5);
    }

    /* Hint card */
    .hint-card {
      background: linear-gradient(135deg, #f5e6d3 0%, #ede0d0 100%);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      color: #3d2e1f;
    }

    .hint-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .laurel-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      overflow: hidden;
      background: #d4a574;
      flex-shrink: 0;
    }

    .laurel-name {
      font-weight: bold;
      color: #8b5a2b;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .speak-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .speak-btn:hover {
      opacity: 1;
    }

    .speak-btn.speaking {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    .hint-text {
      font-size: 18px;
      line-height: 1.5;
      font-style: italic;
      color: #5d4e3c;
    }

    .category-badge {
      display: inline-block;
      background: #d4a574;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      margin-top: 12px;
    }

    /* Game area */
    .game-area {
      flex: 1;
      position: relative;
      background: rgba(30, 24, 18, 0.6);
      border-radius: 16px;
      border: 1px solid rgba(212, 165, 116, 0.2);
      overflow: hidden;
      min-height: 350px;
    }

    /* Falling zone */
    .falling-zone {
      min-height: 180px;
      position: relative;
      border-bottom: 2px dashed rgba(212, 165, 116, 0.3);
      padding: 15px;
    }

    .letters-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      align-items: flex-start;
      padding: 10px;
    }

    .falling-letter {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #ffb74d 0%, #ff9800 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
      color: #3d2e1f;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
      transition: transform 0.1s ease, opacity 0.2s ease;
      user-select: none;
    }

    .falling-letter:hover {
      transform: scale(1.1);
    }

    .falling-letter:active {
      transform: scale(0.95);
    }

    .falling-letter.grabbed {
      opacity: 0.3;
      pointer-events: none;
      transform: scale(0.9);
    }

    /* Shuffle button */
    .shuffle-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin: 10px auto 0;
      padding: 8px 16px;
      background: rgba(212, 165, 116, 0.2);
      border: 1px solid rgba(212, 165, 116, 0.4);
      border-radius: 20px;
      color: #d4a574;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .shuffle-btn:hover {
      background: rgba(212, 165, 116, 0.3);
      border-color: rgba(212, 165, 116, 0.6);
    }

    .shuffle-btn:active {
      transform: scale(0.95);
    }

    /* Answer area */
    .answer-area {
      padding: 20px;
    }

    .answer-label {
      font-size: 12px;
      color: #a89080;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .keyboard-hint {
      font-size: 11px;
      color: #7a6a5a;
      font-style: italic;
      text-transform: none;
      letter-spacing: 0;
    }

    .answer-slots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    .answer-slot {
      width: 44px;
      height: 44px;
      background: rgba(212, 165, 116, 0.1);
      border: 2px dashed rgba(212, 165, 116, 0.4);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
      color: #f5e6d3;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .answer-slot:hover {
      border-color: rgba(212, 165, 116, 0.8);
      background: rgba(212, 165, 116, 0.2);
    }

    .answer-slot.filled {
      background: linear-gradient(135deg, #ffb74d 0%, #ff9800 100%);
      border: none;
      color: #3d2e1f;
    }

    .answer-slot.correct {
      background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
      border: none;
    }

    .answer-slot.wrong-position {
      background: linear-gradient(135deg, #ffd54f 0%, #ffca28 100%);
      border: none;
    }

    .answer-slot.wrong {
      background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
      border: none;
      animation: shake 0.3s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Discard area */
    .discard-area {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 15px;
      min-height: 60px;
    }

    .discard-label {
      font-size: 11px;
      color: #7a6a5a;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .discarded-letters {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .discarded-letter {
      width: 32px;
      height: 32px;
      background: rgba(100, 80, 60, 0.5);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: #7a6a5a;
      text-decoration: line-through;
      cursor: pointer;
    }

    .discarded-letter:hover {
      background: rgba(100, 80, 60, 0.7);
    }

    /* Check button */
    .check-btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin-top: 20px;
      background: linear-gradient(135deg, #d4a574 0%, #b8956a 100%);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3);
    }

    .check-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 165, 116, 0.4);
    }

    .check-btn:active {
      transform: translateY(0);
    }

    .check-btn:disabled {
      background: #5a4a3a;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* NPC reactions */
    .npc-reaction {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(45, 36, 28, 0.95);
      border: 1px solid rgba(212, 165, 116, 0.3);
      border-radius: 12px;
      padding: 12px 16px;
      max-width: 280px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      z-index: 100;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .npc-reaction.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .npc-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      flex-shrink: 0;
      overflow: hidden;
    }

    .npc-content .name {
      font-weight: bold;
      color: #d4a574;
      font-size: 13px;
    }

    .npc-content .message {
      color: #c0b0a0;
      font-size: 14px;
      font-style: italic;
      margin-top: 4px;
    }

    /* Victory screen */
    .victory-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(26, 20, 16, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      overflow-y: auto;
      padding: 20px;
    }

    .victory-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .victory-card {
      background: linear-gradient(135deg, #f5e6d3 0%, #ede0d0 100%);
      border-radius: 20px;
      padding: 35px;
      text-align: center;
      color: #3d2e1f;
      max-width: 380px;
      width: 100%;
      transform: scale(0.8);
      transition: transform 0.5s ease;
    }

    .victory-overlay.visible .victory-card {
      transform: scale(1);
    }

    .victory-emoji {
      font-size: 50px;
      margin-bottom: 15px;
    }

    .victory-title {
      font-size: 26px;
      color: #8b5a2b;
      margin-bottom: 8px;
    }

    .victory-time {
      font-size: 32px;
      color: #d4a574;
      font-family: 'Courier New', monospace;
      margin-bottom: 15px;
    }

    .victory-message {
      color: #5d4e3c;
      font-style: italic;
      margin-bottom: 20px;
      font-size: 15px;
    }

    .victory-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }

    .play-again-btn, .share-btn {
      background: linear-gradient(135deg, #d4a574 0%, #b8956a 100%);
      border: none;
      border-radius: 10px;
      padding: 12px 25px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .share-btn {
      background: linear-gradient(135deg, #5d8a5d 0%, #4a7a4a 100%);
    }

    .play-again-btn:hover, .share-btn:hover {
      transform: scale(1.05);
    }

    .share-toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: #4caf50;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 300;
    }

    .share-toast.visible {
      opacity: 1;
    }

    /* Sister games section */
    .sister-games {
      border-top: 1px solid rgba(139, 90, 43, 0.3);
      padding-top: 20px;
      margin-top: 5px;
    }

    .sister-games-title {
      font-size: 12px;
      color: #8b5a2b;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .sister-games-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .sister-game-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      background: rgba(212, 165, 116, 0.15);
      border-radius: 8px;
      text-decoration: none;
      color: #5d4e3c;
      font-size: 12px;
      transition: all 0.2s;
    }

    .sister-game-link:hover {
      background: rgba(212, 165, 116, 0.3);
    }

    .sister-game-link .emoji {
      font-size: 18px;
    }

    .sister-game-link .name {
      font-weight: bold;
      line-height: 1.2;
    }

    /* Start screen */
    .start-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(26, 20, 16, 0.98);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      transition: opacity 0.5s ease;
      overflow-y: auto;
      padding: 20px;
    }

    .start-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .start-card {
      background: linear-gradient(135deg, #f5e6d3 0%, #ede0d0 100%);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      color: #3d2e1f;
      max-width: 400px;
    }

    .start-logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 15px;
    }

    .start-title {
      font-size: 36px;
      color: #8b5a2b;
      margin-bottom: 5px;
    }

    .start-subtitle {
      color: #a89080;
      font-style: italic;
      margin-bottom: 30px;
    }

    .start-description {
      color: #5d4e3c;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .start-btn {
      background: linear-gradient(135deg, #d4a574 0%, #b8956a 100%);
      border: none;
      border-radius: 12px;
      padding: 16px 50px;
      color: white;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3);
    }

    .start-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(212, 165, 116, 0.4);
    }

    /* Instructions modal */
    .how-to-play {
      background: rgba(45, 36, 28, 0.95);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      text-align: left;
      border: 1px solid rgba(212, 165, 116, 0.2);
    }

    .how-to-play h3 {
      color: #d4a574;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .how-to-play ul {
      list-style: none;
      color: #c0b0a0;
      font-size: 14px;
    }

    .how-to-play li {
      margin-bottom: 10px;
      padding-left: 25px;
      position: relative;
    }

    .how-to-play li::before {
      content: '‚òï';
      position: absolute;
      left: 0;
    }

    /* Voice toggle */
    .voice-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(212, 165, 116, 0.2);
    }

    .voice-toggle label {
      color: #f5e6d3;
      font-size: 14px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
      background: #5a4a3a;
      border-radius: 13px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: #d4a574;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: left 0.3s;
    }

    .toggle-switch.active::after {
      left: 27px;
    }

    /* Jukebox button */
    .jukebox-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 16px;
      background: rgba(212, 165, 116, 0.9);
      border: 2px solid #f5e6d3;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: bold;
      color: #3d2e1f;
      cursor: pointer;
      z-index: 50;
      transition: all 0.2s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .jukebox-btn:hover {
      background: rgba(212, 165, 116, 1);
      transform: scale(1.05);
    }

    .jukebox-btn .btn-icon {
      font-size: 18px;
    }

    .jukebox-btn.playing {
      animation: jukebox-glow 2s ease-in-out infinite;
    }

    @keyframes jukebox-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(212, 165, 116, 0.3); }
      50% { box-shadow: 0 0 15px rgba(212, 165, 116, 0.6); }
    }

    /* Jukebox modal */
    .jukebox-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(26, 20, 16, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 300;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .jukebox-modal.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .jukebox-card {
      background: linear-gradient(135deg, #f5e6d3 0%, #ede0d0 100%);
      border-radius: 16px;
      padding: 30px;
      max-width: 340px;
      width: 90%;
      color: #3d2e1f;
      position: relative;
    }

    .jukebox-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #8b5a2b;
      line-height: 1;
    }

    .jukebox-close:hover {
      color: #3d2e1f;
    }

    .jukebox-icon {
      text-align: center;
      font-size: 36px;
      margin-bottom: 10px;
    }

    .jukebox-title {
      text-align: center;
      font-size: 22px;
      color: #8b5a2b;
      margin-bottom: 20px;
    }

    .now-playing {
      background: rgba(45, 36, 28, 0.9);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      margin-bottom: 15px;
    }

    .now-playing-label {
      font-size: 11px;
      color: #a89080;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }

    .now-playing-track {
      font-size: 16px;
      color: #f5e6d3;
      font-weight: bold;
    }

    .jukebox-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .control-btn {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #d4a574 0%, #b8956a 100%);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
    }

    .control-btn:hover {
      transform: scale(1.1);
    }

    .control-btn.small {
      width: 40px;
      height: 40px;
      font-size: 16px;
      background: rgba(212, 165, 116, 0.3);
      color: #8b5a2b;
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .volume-control span {
      font-size: 16px;
    }

    .volume-slider {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(212, 165, 116, 0.3);
      border-radius: 3px;
      outline: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: #d4a574;
      border-radius: 50%;
      cursor: pointer;
    }

    .volume-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #d4a574;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .playlist-label {
      font-size: 12px;
      color: #8b5a2b;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .playlist {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .playlist-track {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: rgba(212, 165, 116, 0.15);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .playlist-track:hover {
      background: rgba(212, 165, 116, 0.3);
    }

    .playlist-track.active {
      background: rgba(45, 36, 28, 0.9);
      color: #f5e6d3;
    }

    .playlist-track .track-icon {
      font-size: 16px;
    }

    .playlist-track .track-name {
      flex: 1;
      font-size: 14px;
    }

    .playlist-track.active .track-name {
      color: #ffb74d;
    }

    .playlist-track .track-status {
      font-size: 12px;
      color: #a89080;
    }

    .playlist-track.active .track-status {
      color: #4caf50;
    }

    /* Footer */
    .footer {
      background: rgba(26, 20, 16, 0.9);
      border-top: 1px solid rgba(212, 165, 116, 0.2);
      padding: 20px;
      text-align: center;
      margin-top: 30px;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: #a89080;
      text-decoration: none;
      font-size: 13px;
      transition: color 0.2s;
    }

    .footer-links a:hover {
      color: #d4a574;
    }

    .footer-social {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
    }

    .footer-social a {
      color: #a89080;
      text-decoration: none;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      padding: 8px 12px;
      border-radius: 20px;
      background: rgba(212, 165, 116, 0.1);
    }

    .footer-social a:hover {
      color: #d4a574;
      background: rgba(212, 165, 116, 0.25);
      text-decoration: underline;
    }

    .instagram-icon {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    .footer-contact {
      margin-bottom: 12px;
    }

    .footer-contact a {
      color: #a89080;
      text-decoration: none;
      font-size: 13px;
      transition: color 0.2s;
    }

    .footer-contact a:hover {
      color: #d4a574;
    }

    .footer-copyright {
      color: #7a6a5a;
      font-size: 12px;
    }
  </style>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>
  <!-- Rain effect -->
  <div class="rain" id="rain"></div>
  
  <!-- Window glow -->
  <div class="window-glow"></div>

  <!-- SVG Definitions for avatars -->
  <svg style="display: none;">
    <!-- Griddle Falls Logo - Coffee cup only -->
    <symbol id="logo-griddle-falls" viewBox="0 0 100 100">
      <!-- Coffee cup -->
      <ellipse cx="50" cy="80" rx="28" ry="8" fill="#8b5a2b"/>
      <path d="M25 40 L25 75 Q25 85 50 85 Q75 85 75 75 L75 40 Z" fill="#d4a574"/>
      <ellipse cx="50" cy="40" rx="25" ry="8" fill="#c49464"/>
      <ellipse cx="50" cy="40" rx="20" ry="6" fill="#4a3728"/>
      <!-- Steam -->
      <path d="M35 30 Q32 20 38 12" stroke="#a89080" stroke-width="3" fill="none" stroke-linecap="round"/>
      <path d="M50 28 Q47 15 53 5" stroke="#a89080" stroke-width="3" fill="none" stroke-linecap="round"/>
      <path d="M65 30 Q62 20 68 12" stroke="#a89080" stroke-width="3" fill="none" stroke-linecap="round"/>
      <!-- Handle -->
      <path d="M75 47 Q92 47 92 60 Q92 73 75 73" stroke="#d4a574" stroke-width="6" fill="none"/>
    </symbol>

    <!-- Laurel - Cafe owner with long straight thick hair -->
    <symbol id="avatar-laurel" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#d4a574"/>
      <!-- Long straight thick hair - behind -->
      <path d="M20 35 L20 85 Q20 90 30 90 L30 40 Q30 20 50 18 Q70 20 70 40 L70 90 Q80 90 80 85 L80 35 Q80 10 50 10 Q20 10 20 35 Z" fill="#3d2314"/>
      <!-- Face -->
      <circle cx="50" cy="42" r="22" fill="#f5deb3"/>
      <!-- Hair front pieces -->
      <path d="M28 30 Q28 18 50 16 Q72 18 72 30 L72 42 Q72 25 50 23 Q28 25 28 42 Z" fill="#3d2314"/>
      <!-- Side hair strands -->
      <path d="M28 40 L25 70" stroke="#3d2314" stroke-width="8" stroke-linecap="round"/>
      <path d="M72 40 L75 70" stroke="#3d2314" stroke-width="8" stroke-linecap="round"/>
      <!-- Eyes -->
      <circle cx="42" cy="40" r="3" fill="#3d2e1f"/>
      <circle cx="58" cy="40" r="3" fill="#3d2e1f"/>
      <!-- Smile -->
      <path d="M42 50 Q50 57 58 50" stroke="#3d2e1f" stroke-width="2" fill="none"/>
      <!-- Apron hint -->
      <path d="M35 75 L35 95 L65 95 L65 75" fill="#f5e6d3"/>
      <rect x="45" y="78" width="10" height="8" fill="#d4a574" rx="2"/>
    </symbol>

    <!-- Sarah - Caring older sister type -->
    <symbol id="avatar-sarah" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#b8956a"/>
      <circle cx="50" cy="40" r="22" fill="#ffe4c4"/>
      <ellipse cx="50" cy="85" rx="30" ry="20" fill="#6b8e23"/>
      <!-- Hair - longer -->
      <path d="M25 40 Q25 10 50 10 Q75 10 75 40 L78 55 Q78 60 72 55 L72 40 Q72 15 50 15 Q28 15 28 40 L28 55 Q22 60 22 55 Z" fill="#8b4513"/>
      <!-- Eyes - warm -->
      <circle cx="42" cy="38" r="3" fill="#3d2e1f"/>
      <circle cx="58" cy="38" r="3" fill="#3d2e1f"/>
      <!-- Gentle smile -->
      <path d="M40 48 Q50 56 60 48" stroke="#3d2e1f" stroke-width="2" fill="none"/>
      <!-- Glasses -->
      <circle cx="42" cy="38" r="8" stroke="#d4a574" stroke-width="2" fill="none"/>
      <circle cx="58" cy="38" r="8" stroke="#d4a574" stroke-width="2" fill="none"/>
      <line x1="50" y1="38" x2="50" y2="38" stroke="#d4a574" stroke-width="2"/>
    </symbol>

    <!-- Taylor B - TV enthusiast -->
    <symbol id="avatar-taylor" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#a89080"/>
      <circle cx="50" cy="40" r="22" fill="#deb887"/>
      <ellipse cx="50" cy="85" rx="30" ry="20" fill="#4169e1"/>
      <!-- Short hair -->
      <path d="M30 35 Q30 12 50 12 Q70 12 70 35 L68 28 Q68 18 50 18 Q32 18 32 28 Z" fill="#2f1f0f"/>
      <!-- Eyes - excited -->
      <circle cx="42" cy="38" r="4" fill="#3d2e1f"/>
      <circle cx="58" cy="38" r="4" fill="#3d2e1f"/>
      <!-- Sparkle in eye -->
      <circle cx="43" cy="37" r="1" fill="white"/>
      <circle cx="59" cy="37" r="1" fill="white"/>
      <!-- Big smile -->
      <path d="M38 48 Q50 60 62 48" stroke="#3d2e1f" stroke-width="2" fill="none"/>
    </symbol>

    <!-- Mr. Lindsay - Friendly dog groomer -->
    <symbol id="avatar-mr-lindsay" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#c9b896"/>
      <circle cx="50" cy="40" r="22" fill="#f5deb3"/>
      <ellipse cx="50" cy="85" rx="30" ry="20" fill="#2e8b57"/>
      <!-- Balding with sides -->
      <path d="M28 38 Q28 30 35 30 L35 35 Q32 35 32 38 Z" fill="#808080"/>
      <path d="M72 38 Q72 30 65 30 L65 35 Q68 35 68 38 Z" fill="#808080"/>
      <!-- Eyes - kind -->
      <circle cx="42" cy="38" r="3" fill="#3d2e1f"/>
      <circle cx="58" cy="38" r="3" fill="#3d2e1f"/>
      <!-- Mustache -->
      <path d="M40 50 Q50 55 60 50 Q50 52 40 50" fill="#808080"/>
      <!-- Smile -->
      <path d="M42 55 Q50 60 58 55" stroke="#3d2e1f" stroke-width="2" fill="none"/>
    </symbol>

    <!-- Mrs. Lindsay - Friendly dog groomer -->
    <symbol id="avatar-mrs-lindsay" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#d4b896"/>
      <circle cx="50" cy="40" r="22" fill="#ffe4c4"/>
      <ellipse cx="50" cy="85" rx="30" ry="20" fill="#da70d6"/>
      <!-- Curly hair -->
      <circle cx="30" cy="30" r="10" fill="#c0c0c0"/>
      <circle cx="45" cy="22" r="10" fill="#c0c0c0"/>
      <circle cx="55" cy="22" r="10" fill="#c0c0c0"/>
      <circle cx="70" cy="30" r="10" fill="#c0c0c0"/>
      <circle cx="25" cy="42" r="8" fill="#c0c0c0"/>
      <circle cx="75" cy="42" r="8" fill="#c0c0c0"/>
      <!-- Eyes -->
      <circle cx="42" cy="38" r="3" fill="#3d2e1f"/>
      <circle cx="58" cy="38" r="3" fill="#3d2e1f"/>
      <!-- Rosy cheeks -->
      <circle cx="35" cy="45" r="5" fill="#ffb6c1" opacity="0.5"/>
      <circle cx="65" cy="45" r="5" fill="#ffb6c1" opacity="0.5"/>
      <!-- Smile -->
      <path d="M42 50 Q50 58 58 50" stroke="#3d2e1f" stroke-width="2" fill="none"/>
    </symbol>

    <!-- Jennie with Isaac (chihuahua) -->
    <symbol id="avatar-jennie" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#e8d4b8"/>
      <circle cx="45" cy="42" r="20" fill="#ffe4c4"/>
      <ellipse cx="45" cy="82" rx="25" ry="18" fill="#ff6347"/>
      <!-- Hair -->
      <path d="M25 40 Q25 15 45 15 Q65 15 65 40 L68 50 Q68 55 62 50 L62 40 Q62 22 45 22 Q28 22 28 40 L28 50 Q22 55 22 50 Z" fill="#1a0f0a"/>
      <!-- Eyes -->
      <circle cx="38" cy="40" r="2.5" fill="#3d2e1f"/>
      <circle cx="52" cy="40" r="2.5" fill="#3d2e1f"/>
      <!-- Smile -->
      <path d="M38 50 Q45 55 52 50" stroke="#3d2e1f" stroke-width="2" fill="none"/>
      <!-- Isaac the Chihuahua -->
      <ellipse cx="78" cy="35" rx="15" ry="12" fill="#d2b48c"/>
      <circle cx="78" cy="30" r="10" fill="#d2b48c"/>
      <!-- Chihuahua ears -->
      <path d="M68 22 L72 30 L68 30 Z" fill="#d2b48c"/>
      <path d="M88 22 L84 30 L88 30 Z" fill="#d2b48c"/>
      <!-- Chihuahua eyes -->
      <circle cx="74" cy="28" r="3" fill="#3d2e1f"/>
      <circle cx="82" cy="28" r="3" fill="#3d2e1f"/>
      <!-- Chihuahua nose -->
      <circle cx="78" cy="34" r="2" fill="#3d2e1f"/>
    </symbol>

    <!-- Josephine - Cat-loving mom -->
    <symbol id="avatar-josephine" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#d4c4b0"/>
      <circle cx="50" cy="40" r="22" fill="#ffe4c4"/>
      <ellipse cx="50" cy="85" rx="30" ry="20" fill="#800080"/>
      <!-- Hair in bun -->
      <path d="M28 38 Q28 15 50 15 Q72 15 72 38 L72 30 Q72 20 50 20 Q28 20 28 30 Z" fill="#696969"/>
      <circle cx="50" cy="12" r="10" fill="#696969"/>
      <!-- Eyes -->
      <circle cx="42" cy="38" r="3" fill="#3d2e1f"/>
      <circle cx="58" cy="38" r="3" fill="#3d2e1f"/>
      <!-- Reading glasses on nose -->
      <ellipse cx="42" cy="42" rx="7" ry="5" stroke="#8b4513" stroke-width="1.5" fill="none"/>
      <ellipse cx="58" cy="42" rx="7" ry="5" stroke="#8b4513" stroke-width="1.5" fill="none"/>
      <line x1="49" y1="42" x2="51" y2="42" stroke="#8b4513" stroke-width="1.5"/>
      <!-- Gentle smile -->
      <path d="M44 52 Q50 56 56 52" stroke="#3d2e1f" stroke-width="2" fill="none"/>
    </symbol>

    <!-- Josie - Cat-loving daughter -->
    <symbol id="avatar-josie" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#f0e6d3"/>
      <circle cx="50" cy="40" r="22" fill="#ffe4c4"/>
      <ellipse cx="50" cy="85" rx="30" ry="20" fill="#ff69b4"/>
      <!-- Young hair with cat ears headband -->
      <path d="M28 40 Q28 12 50 12 Q72 12 72 40 L72 35 Q72 18 50 18 Q28 18 28 35 Z" fill="#696969"/>
      <!-- Cat ear headband -->
      <path d="M30 20 L35 8 L42 20" fill="#ff69b4"/>
      <path d="M70 20 L65 8 L58 20" fill="#ff69b4"/>
      <!-- Eyes - youthful -->
      <circle cx="42" cy="38" r="4" fill="#3d2e1f"/>
      <circle cx="58" cy="38" r="4" fill="#3d2e1f"/>
      <circle cx="43" cy="36" r="1.5" fill="white"/>
      <circle cx="59" cy="36" r="1.5" fill="white"/>
      <!-- Smile -->
      <path d="M42 50 Q50 58 58 50" stroke="#3d2e1f" stroke-width="2" fill="none"/>
    </symbol>

    <!-- The whole cafe - group icon -->
    <symbol id="avatar-cafe" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" fill="#2d241c"/>
      <!-- Multiple small faces -->
      <circle cx="30" cy="35" r="12" fill="#ffe4c4"/>
      <circle cx="50" cy="30" r="12" fill="#deb887"/>
      <circle cx="70" cy="35" r="12" fill="#f5deb3"/>
      <circle cx="35" cy="55" r="12" fill="#ffe4c4"/>
      <circle cx="55" cy="60" r="12" fill="#deb887"/>
      <circle cx="75" cy="55" r="12" fill="#f5deb3"/>
      <!-- Coffee cups -->
      <rect x="20" y="75" width="15" height="10" fill="#d4a574" rx="2"/>
      <rect x="42" y="78" width="15" height="10" fill="#d4a574" rx="2"/>
      <rect x="65" y="75" width="15" height="10" fill="#d4a574" rx="2"/>
    </symbol>
  </svg>

  <!-- Share toast -->
  <div class="share-toast" id="shareToast">Copied to clipboard!</div>

  <!-- Jukebox button -->
  <button class="jukebox-btn" id="jukeboxBtn" onclick="toggleJukebox()" title="Jukebox">
    <span class="btn-icon">üéµ</span> Jukebox
  </button>

  <!-- Jukebox modal -->
  <div class="jukebox-modal" id="jukeboxModal">
    <div class="jukebox-card">
      <button class="jukebox-close" onclick="toggleJukebox()">√ó</button>
      <div class="jukebox-icon">üéµ</div>
      <h2 class="jukebox-title">Jukebox</h2>
      
      <div class="now-playing">
        <div class="now-playing-label">Now Playing</div>
        <div class="now-playing-track" id="nowPlayingTrack">Select a track</div>
      </div>
      
      <div class="jukebox-controls">
        <button class="control-btn small" onclick="prevTrack()">‚èÆ</button>
        <button class="control-btn" id="playPauseBtn" onclick="togglePlay()">‚ñ∂</button>
        <button class="control-btn small" onclick="nextTrack()">‚è≠</button>
      </div>
      
      <div class="volume-control">
        <span>üîà</span>
        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" onchange="setVolume(this.value)">
        <span>üîä</span>
      </div>
      
      <div class="playlist-label">Playlist</div>
      <div class="playlist" id="playlist">
        <!-- Tracks added by JS -->
      </div>
    </div>
  </div>

  <!-- Start screen -->
  <div class="start-overlay" id="startOverlay">
    <div class="start-card">
      <svg class="start-logo"><use href="#logo-griddle-falls"/></svg>
      <h1 class="start-title">Griddle Falls</h1>
      <p class="start-subtitle">Sunday Trivia Night at the Letter Griddle Cafe</p>
      <p class="start-description">
        Laurel reads the clue. Letters appear. Some belong in the answer, some are decoys. 
        Sort them fast to beat your best time!
      </p>
      <button class="start-btn" onclick="startGame()">Start Trivia Night</button>
      
      <div class="how-to-play">
        <h3>‚òï How to Play</h3>
        <ul>
          <li>Click letters or type on keyboard</li>
          <li>Click placed letters to remove them</li>
          <li>Use shuffle to rearrange letters</li>
          <li>Yellow = right letter, wrong spot</li>
          <li>Green = perfect!</li>
          <li>Solve all 5 words to complete trivia night</li>
        </ul>
        
        <div class="voice-toggle">
          <label>üîä Laurel reads hints aloud</label>
          <div class="toggle-switch active" id="voiceToggle" onclick="toggleVoice()"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Victory screen -->
  <div class="victory-overlay" id="victoryOverlay">
    <div class="victory-card">
      <div class="victory-emoji">üèÜ</div>
      <h2 class="victory-title">Trivia Night Complete!</h2>
      <div class="victory-time" id="finalTime">0:00</div>
      <p class="victory-message" id="victoryMessage">"Well done!" says Laurel, pouring you a celebratory coffee.</p>
      
      <div class="victory-buttons">
        <button class="play-again-btn" onclick="restartGame()">Play Again</button>
        <button class="share-btn" onclick="shareResults()">Share</button>
      </div>
      
      <div class="sister-games">
        <div class="sister-games-title">More from the Letter Griddle Cafe</div>
        <div class="sister-games-grid">
          <a href="https://lettergriddle.com" target="_blank" class="sister-game-link">
            <span class="emoji">ü•û</span>
            <span class="name">Letter Griddle</span>
          </a>
          <a href="https://littlelettergriddle.com" target="_blank" class="sister-game-link">
            <span class="emoji">üåô</span>
            <span class="name">Little Letter Griddle</span>
          </a>
          <a href="https://lettergriddlebuffet.com" target="_blank" class="sister-game-link">
            <span class="emoji">üçΩÔ∏è</span>
            <span class="name">Letter Griddle Buffet</span>
          </a>
          <a href="https://kerflufflegrid.com" target="_blank" class="sister-game-link">
            <span class="emoji">üåÄ</span>
            <span class="name">Kerflufflegrid</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main game -->
  <div class="container">
    <header class="header">
      <svg class="logo"><use href="#logo-griddle-falls"/></svg>
      <h1 class="title">Griddle Falls</h1>
      <p class="subtitle">Sunday Trivia Night</p>
    </header>

    <div class="status-bar">
      <div class="timer-section">
        <div class="cafe-time">‚òï It's always trivia time somewhere.</div>
        <div class="timer" id="timer">0:00</div>
      </div>
      <div style="text-align: right;">
        <div class="progress"><span id="wordNum">1</span> of 5</div>
        <div class="progress-dots" id="progressDots">
          <div class="dot current"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </div>

    <div class="hint-card">
      <div class="hint-header">
        <svg class="laurel-avatar"><use href="#avatar-laurel"/></svg>
        <span class="laurel-name">
          Laurel
          <button class="speak-btn" id="speakBtn" onclick="speakHint()" title="Read hint aloud">üîä</button>
        </span>
      </div>
      <p class="hint-text" id="hintText">"Loading today's trivia..."</p>
      <span class="category-badge" id="categoryBadge">Category</span>
    </div>

    <div class="game-area">
      <div class="falling-zone" id="fallingZone">
        <div class="letters-grid" id="lettersGrid">
          <!-- Letters appear here -->
        </div>
        <button class="shuffle-btn" onclick="shuffleLetters()">
          üîÄ Shuffle
        </button>
      </div>
      
      <div class="answer-area">
        <div class="answer-label">
          Your Answer
          <span class="keyboard-hint">(or type letters)</span>
        </div>
        <div class="answer-slots" id="answerSlots">
          <!-- Answer slots generated dynamically -->
        </div>
        
        <div class="discard-area">
          <div class="discard-label">Crossed Out</div>
          <div class="discarded-letters" id="discardedLetters">
            <!-- Discarded letters appear here -->
          </div>
        </div>
      </div>
    </div>

    <button class="check-btn" id="checkBtn" onclick="checkAnswer()" disabled>Check Answer</button>

    <footer class="footer">
      <div class="footer-links">
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
      </div>
      <div class="footer-social">
        <a href="https://www.instagram.com/letter_griddle" target="_blank" rel="noopener noreferrer" style="cursor: pointer;">
          <svg class="instagram-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
          </svg>
          Follow @letter_griddle
        </a>
      </div>
      <div class="footer-contact">
        <a href="mailto:lettergriddle@gmail.com">lettergriddle@gmail.com</a>
      </div>
      <div class="footer-copyright">
        ¬© <span id="copyrightYear"></span> Griddle Falls
      </div>
    </footer>
  </div>

  <!-- NPC reaction bubble -->
  <div class="npc-reaction" id="npcReaction">
    <svg class="npc-avatar" id="npcAvatar"><use href="#avatar-sarah"/></svg>
    <div class="npc-content">
      <div class="name" id="npcName">Sarah</div>
      <div class="message" id="npcMessage">"You're so close!"</div>
    </div>
  </div>

  <script>
    // Puzzle data - 31 CATEGORIES
    const puzzles = [
      {
        category: "Candy",
        words: [
          { word: "MINT", hint: "A refreshing flavored candy often used after dinner" },
          { word: "TAFFY", hint: "A chewy candy often sold at boardwalks and beaches" },
          { word: "GUMMY", hint: "Soft, chewy candy often shaped like bears or worms" },
          { word: "LOLLIPOP", hint: "Hard candy on a stick, a classic carnival treat" },
          { word: "CHOCOLATE", hint: "Sweet treat made from cacao beans, enjoyed worldwide" }
        ]
      },
      {
        category: "Autumn",
        words: [
          { word: "LEAF", hint: "Tree foliage that changes color and falls in this season" },
          { word: "APPLE", hint: "Round fruit often picked at orchards in fall" },
          { word: "PUMPKIN", hint: "Large orange gourd carved for Halloween" },
          { word: "HARVEST", hint: "The gathering of crops at the end of the growing season" },
          { word: "SWEATER", hint: "Cozy knitted clothing worn when temperatures drop" }
        ]
      },
      {
        category: "Hiking",
        words: [
          { word: "BOOT", hint: "Sturdy footwear essential for trail walking" },
          { word: "TRAIL", hint: "A marked path through nature for walking" },
          { word: "SUMMIT", hint: "The highest point of a mountain" },
          { word: "COMPASS", hint: "Navigation tool that points north" },
          { word: "BACKPACK", hint: "Bag worn on shoulders to carry supplies" }
        ]
      },
      {
        category: "Dessert",
        words: [
          { word: "TART", hint: "A pastry with fruit filling and no top crust" },
          { word: "FUDGE", hint: "Rich, creamy chocolate confection" },
          { word: "SUNDAE", hint: "Ice cream topped with sauce, whipped cream, and a cherry" },
          { word: "BROWNIE", hint: "Dense, chocolate baked square dessert" },
          { word: "CHEESECAKE", hint: "Creamy dessert with a graham cracker crust" }
        ]
      },
      {
        category: "What's in the bag?",
        words: [
          { word: "KEYS", hint: "Metal items that unlock doors and start cars" },
          { word: "PHONE", hint: "Mobile device for calls, texts, and apps" },
          { word: "WALLET", hint: "Folding case for money and cards" },
          { word: "LIPSTICK", hint: "Cosmetic applied to add color to lips" },
          { word: "SUNGLASSES", hint: "Eyewear that protects from bright light" }
        ]
      },
      {
        category: "Fruits",
        words: [
          { word: "PEAR", hint: "A sweet fruit with a narrow top and rounded bottom" },
          { word: "MANGO", hint: "Tropical stone fruit with orange flesh" },
          { word: "ORANGE", hint: "Citrus fruit known for its vitamin C content" },
          { word: "APRICOT", hint: "Small orange stone fruit related to peaches" },
          { word: "PINEAPPLE", hint: "Tropical fruit with spiky skin and sweet yellow interior" }
        ]
      },
      {
        category: "Animals",
        words: [
          { word: "BEAR", hint: "Large mammal that hibernates in winter" },
          { word: "TIGER", hint: "Large striped cat native to Asia" },
          { word: "GIRAFFE", hint: "Tallest land animal with a long neck" },
          { word: "ELEPHANT", hint: "Largest land mammal with a trunk" },
          { word: "ALLIGATOR", hint: "Large reptile found in swamps and rivers" }
        ]
      },
      {
        category: "Occupations",
        words: [
          { word: "CHEF", hint: "Professional who prepares food in a restaurant" },
          { word: "NURSE", hint: "Healthcare worker who cares for patients" },
          { word: "TEACHER", hint: "Educator who instructs students in a classroom" },
          { word: "ENGINEER", hint: "Professional who designs and builds systems" },
          { word: "ARCHITECT", hint: "Designer of buildings and structures" }
        ]
      },
      {
        category: "Sports",
        words: [
          { word: "GOLF", hint: "Sport played with clubs and a small white ball" },
          { word: "RUGBY", hint: "Contact team sport played with an oval ball" },
          { word: "TENNIS", hint: "Racquet sport played on a court with a net" },
          { word: "SWIMMING", hint: "Water sport involving moving through water" },
          { word: "BASKETBALL", hint: "Team sport where players shoot a ball through a hoop" }
        ]
      },
      {
        category: "U.S. States",
        words: [
          { word: "UTAH", hint: "Western state known for its national parks" },
          { word: "TEXAS", hint: "The Lone Star State, second largest by area" },
          { word: "OREGON", hint: "Pacific Northwest state known for its forests" },
          { word: "GEORGIA", hint: "Southern state known as the Peach State" },
          { word: "CALIFORNIA", hint: "Most populous state on the West Coast" }
        ]
      },
      {
        category: "School Days",
        words: [
          { word: "DESK", hint: "Furniture where students sit and work" },
          { word: "LUNCH", hint: "Midday meal eaten in the cafeteria" },
          { word: "RECESS", hint: "Break time for outdoor play" },
          { word: "SCIENCE", hint: "Subject exploring how the world works" },
          { word: "TEXTBOOK", hint: "Educational book used for studying" }
        ]
      },
      {
        category: "Trees and Shrubs",
        words: [
          { word: "PALM", hint: "Tropical tree with large fan-shaped or feathery leaves" },
          { word: "MAPLE", hint: "Deciduous tree known for its colorful fall foliage and sweet sap" },
          { word: "BANYAN", hint: "Fig tree with aerial roots that grow down to form additional trunks" },
          { word: "JASMINE", hint: "Fragrant flowering shrub often used in perfumes and teas" },
          { word: "CINNAMON", hint: "Aromatic evergreen tree whose inner bark is used as a spice" }
        ]
      },
      {
        category: "Movie Titles",
        words: [
          { word: "JAWS", hint: "1975 Spielberg thriller about a great white shark terrorizing a beach town" },
          { word: "ALIEN", hint: "1979 sci-fi horror classic with Sigourney Weaver fighting extraterrestrials" },
          { word: "FROZEN", hint: "Disney animated film featuring Elsa, Anna, and the song 'Let It Go'" },
          { word: "TITANIC", hint: "1997 epic romance about the doomed ocean liner starring DiCaprio and Winslet" },
          { word: "INCEPTION", hint: "Christopher Nolan mind-bending thriller about dreams within dreams" }
        ]
      },
      {
        category: "Colors",
        words: [
          { word: "BLUE", hint: "The color of a clear sky on a sunny day" },
          { word: "BEIGE", hint: "A neutral sandy or tan shade often used in interior design" },
          { word: "INDIGO", hint: "A deep purple-blue color between blue and violet in the rainbow" },
          { word: "EMERALD", hint: "A rich green color named after a precious gemstone" },
          { word: "BURGUNDY", hint: "A deep reddish-purple wine color named after a French region" }
        ]
      },
      {
        category: "International Foods",
        words: [
          { word: "TACO", hint: "A Mexican dish with a folded tortilla and various fillings" },
          { word: "SUSHI", hint: "Japanese dish of vinegared rice with raw fish or vegetables" },
          { word: "PAELLA", hint: "A Spanish rice dish from Valencia with seafood and saffron" },
          { word: "RAVIOLI", hint: "Italian pasta pillows filled with cheese, meat, or vegetables" },
          { word: "CROISSANT", hint: "A flaky, buttery French pastry shaped like a crescent" }
        ]
      },
      {
        category: "Games",
        words: [
          { word: "RISK", hint: "Strategic board game of world domination with armies and dice" },
          { word: "CHESS", hint: "Ancient strategy game with kings, queens, and checkmate" },
          { word: "DOMINO", hint: "Tile game with numbered dots played by matching ends" },
          { word: "YAHTZEE", hint: "Dice game where players try to score combinations and get five of a kind" },
          { word: "SCRABBLE", hint: "Word-building board game where letter tiles score points on a grid" }
        ]
      },
      {
        category: "Cities Around the World",
        words: [
          { word: "ROME", hint: "Ancient Italian city known as the Eternal City, home to the Colosseum" },
          { word: "PARIS", hint: "French capital famous for the Eiffel Tower and the Louvre Museum" },
          { word: "LONDON", hint: "UK capital on the Thames River with Big Ben and Buckingham Palace" },
          { word: "TORONTO", hint: "Canada's largest city, known for the CN Tower and multicultural neighborhoods" },
          { word: "BARCELONA", hint: "Spanish coastal city famous for Gaudi's architecture and La Rambla" }
        ]
      },
      {
        category: "Cool Weather Clothing",
        words: [
          { word: "COAT", hint: "A long outer garment worn over other clothes for warmth" },
          { word: "SCARF", hint: "A piece of fabric worn around the neck for warmth or style" },
          { word: "JACKET", hint: "A shorter outer garment that covers the upper body and arms" },
          { word: "SWEATER", hint: "A knitted garment worn on the upper body, often made of wool" },
          { word: "CASHMERE", hint: "A luxuriously soft wool fabric from the Kashmir goat" }
        ]
      },
      {
        category: "Friendship",
        words: [
          { word: "ALLY", hint: "A trusted friend who supports and stands by you" },
          { word: "LOYAL", hint: "Faithful and devoted through thick and thin" },
          { word: "TRUSTY", hint: "Reliable and dependable, someone you can count on" },
          { word: "SUPPORT", hint: "To give help, encouragement, and assistance to someone" },
          { word: "KINDNESS", hint: "The quality of being friendly, generous, and considerate" }
        ]
      },
      {
        category: "Art Projects",
        words: [
          { word: "LINE", hint: "A mark made by a pencil, pen, or brush across a surface" },
          { word: "SHADE", hint: "The use of darkness to create depth and dimension in artwork" },
          { word: "CANVAS", hint: "A piece of cloth stretched over a frame for painting" },
          { word: "DRAWING", hint: "The art of creating images with pencils, pens, or charcoal" },
          { word: "COLLAGE", hint: "Artwork made by gluing paper, photos, and other materials together" }
        ]
      },
      {
        category: "Musicals",
        words: [
          { word: "RENT", hint: "Jonathan Larson's rock musical about struggling artists in New York City" },
          { word: "EVITA", hint: "Andrew Lloyd Webber musical about Argentina's first lady Eva Per√≥n" },
          { word: "WICKED", hint: "Musical telling the untold story of the witches of Oz" },
          { word: "COMPANY", hint: "Stephen Sondheim musical about a bachelor and his married friends" },
          { word: "HAMILTON", hint: "Lin-Manuel Miranda's hip-hop musical about a founding father" }
        ]
      },
      {
        category: "Football",
        words: [
          { word: "DOWN", hint: "A play in football; teams get four tries to advance 10 yards" },
          { word: "BLITZ", hint: "A defensive play where extra players rush the quarterback" },
          { word: "CENTER", hint: "The offensive lineman who snaps the ball to the quarterback" },
          { word: "DEFENSE", hint: "The team trying to stop the other team from scoring" },
          { word: "GRIDIRON", hint: "Another name for a football field, named for its yard lines" }
        ]
      },
      {
        category: "Game Night",
        words: [
          { word: "UNO", hint: "Popular card game where players match colors and numbers" },
          { word: "CLUE", hint: "Classic murder mystery board game with suspects and weapons" },
          { word: "TWISTER", hint: "Physical game with colored circles where players contort their bodies" },
          { word: "CHECKERS", hint: "Strategy board game where pieces jump to capture opponents" },
          { word: "MONOPOLY", hint: "Real estate trading game where players buy properties and collect rent" }
        ]
      },
      {
        category: "It's a Mystery!",
        words: [
          { word: "CLUE", hint: "A piece of evidence that helps solve a puzzle or crime" },
          { word: "CRIME", hint: "An illegal act that breaks the law" },
          { word: "ARREST", hint: "When police take someone into custody for breaking the law" },
          { word: "SUSPECT", hint: "A person believed to have committed a crime" },
          { word: "SOLUTION", hint: "The answer or resolution to a mystery or problem" }
        ]
      },
      {
        category: "Favorite Bookshop",
        words: [
          { word: "CAFE", hint: "A cozy spot in a bookstore serving coffee and treats" },
          { word: "MERCH", hint: "Merchandise like bookmarks, tote bags, and literary-themed gifts" },
          { word: "AUTHOR", hint: "A writer who may visit to discuss and promote their books" },
          { word: "SIGNING", hint: "An event where a writer autographs copies of their book" },
          { word: "AMBIANCE", hint: "The welcoming atmosphere and character of a beloved bookshop" }
        ]
      },
      {
        category: "Music Storage",
        words: [
          { word: "DISK", hint: "A circular storage medium for music, like CDs or vinyl" },
          { word: "TRACK", hint: "An individual song on an album or recording" },
          { word: "RECORD", hint: "A vinyl disc that plays music when spun on a turntable" },
          { word: "NAPSTER", hint: "Revolutionary file-sharing service that changed music distribution" },
          { word: "CASSETTE", hint: "Magnetic tape format popular in the 1980s and 90s" }
        ]
      },
      {
        category: "Jim Henson's Muppets",
        words: [
          { word: "BIRD", hint: "Big yellow character who lives on Sesame Street" },
          { word: "PIGGY", hint: "Miss ___, glamorous diva and Kermit's love interest" },
          { word: "KERMIT", hint: "The famous green frog who sings 'Rainbow Connection'" },
          { word: "SNUFFLE", hint: "___ upagus, the woolly mammoth-like creature on Sesame Street" },
          { word: "PUPPETRY", hint: "The art of bringing characters to life with hand movements" }
        ]
      },
      {
        category: "Pizza, pizza!",
        words: [
          { word: "MEAT", hint: "A savory protein topping category for pizza" },
          { word: "SAUCE", hint: "Tomato-based spread that goes on the dough" },
          { word: "TOMATO", hint: "Red fruit used as the base for pizza sauce" },
          { word: "SAUSAGE", hint: "Spiced ground meat topping, often Italian-style" },
          { word: "MUSHROOM", hint: "Earthy fungus that's a popular vegetable topping" }
        ]
      },
      {
        category: "Video Games",
        words: [
          { word: "PONG", hint: "Classic table tennis video game from the 1970s" },
          { word: "ATARI", hint: "Iconic gaming company that pioneered home video game consoles" },
          { word: "ARCADE", hint: "Entertainment venue filled with coin-operated game machines" },
          { word: "CONSOLE", hint: "Home gaming device that connects to a TV" },
          { word: "JOYSTICK", hint: "Hand-held controller used to navigate games" }
        ]
      },
      {
        category: "At the Lake",
        words: [
          { word: "FISH", hint: "To cast a line and try to catch dinner" },
          { word: "CANOE", hint: "A narrow boat you paddle through the water" },
          { word: "SNOOZE", hint: "To take a lazy nap in the afternoon sun" },
          { word: "BONFIRE", hint: "A large outdoor fire for gathering and roasting marshmallows" },
          { word: "HAMMOCK", hint: "A hanging bed made of fabric or rope, perfect for relaxing" }
        ]
      },
      {
        category: "Vacation",
        words: [
          { word: "REST", hint: "To take it easy and recover your energy" },
          { word: "BREAK", hint: "Time away from work or school" },
          { word: "LEAVE", hint: "To depart or time off granted from your job" },
          { word: "HOLIDAY", hint: "A special day or period of celebration and time off" },
          { word: "RELAXING", hint: "The act of unwinding and letting stress melt away" }
        ]
      }
    ];

    // NPC reactions with avatar references
    const npcs = {
      correct: [
        { name: "Sarah", avatar: "avatar-sarah", message: "I knew you'd get it!" },
        { name: "Taylor B.", avatar: "avatar-taylor", message: "I knew I heard that somewhere!" },
        { name: "Mr. Lindsay", avatar: "avatar-mr-lindsay", message: "Brilliant! Simply brilliant!" },
        { name: "Josie", avatar: "avatar-josie", message: "Mom, they got it!" }
      ],
      close: [
        { name: "Sarah", avatar: "avatar-sarah", message: "You're so close, I can feel it!" },
        { name: "Mrs. Lindsay", avatar: "avatar-mrs-lindsay", message: "Almost there, dear!" },
        { name: "Josephine", avatar: "avatar-josephine", message: "Hmm, not quite... but close!" },
        { name: "Jennie", avatar: "avatar-jennie", message: "Isaac thinks you're onto something..." }
      ],
      wrong: [
        { name: "Mr. Lindsay", avatar: "avatar-mr-lindsay", message: "Ooh, that's not it, but don't give up!" },
        { name: "Taylor B.", avatar: "avatar-taylor", message: "Hmm, that doesn't sound right..." },
        { name: "Josie", avatar: "avatar-josie", message: "Try again! You've got this!" }
      ],
      victory: [
        { name: "Laurel", avatar: "avatar-laurel", message: "Another perfect trivia night! Coffee's on the house." },
        { name: "The whole cafe", avatar: "avatar-cafe", message: "*applause and coffee cups clinking*" },
        { name: "Sarah", avatar: "avatar-sarah", message: "That was impressive! Same time next Sunday?" }
      ]
    };

    // Game state
    let currentPuzzle = null;
    let currentWordIndex = 0;
    let currentWord = null;
    let timerInterval = null;
    let startTime = null;
    let gameStarted = false;
    let answerLetters = [];
    let discardedLetters = [];
    let fallingLetters = [];
    let voiceEnabled = true;
    let gameResults = []; // Track results for sharing

    // Toggle voice
    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      document.getElementById('voiceToggle').classList.toggle('active', voiceEnabled);
    }

    // Speak hint using Web Speech API - American English voice
    function speakHint() {
      if (!('speechSynthesis' in window)) {
        console.log('Speech synthesis not supported');
        return;
      }
      
      // Cancel any ongoing speech
      speechSynthesis.cancel();
      
      const hint = currentWord ? currentWord.hint : '';
      if (!hint) return;
      
      const utterance = new SpeechSynthesisUtterance(hint);
      utterance.rate = 0.9;
      
      // Prioritize American English female voices
      const voices = speechSynthesis.getVoices();
      
      // Priority order for American female voices
     const preferredVoices = [
  'Ava', // macOS - very natural
  'Allison', // macOS - friendly
  'Zoe', // macOS - warm
  'Samantha (Enhanced)',
  'Samantha',
  'Karen',
  'Google US English',
  'en-US',
  'en_US'
];
      
      let selectedVoice = null;
      
      // First try to find a preferred American voice
      for (const preferred of preferredVoices) {
        selectedVoice = voices.find(v => 
          v.name.includes(preferred) || 
          v.lang === preferred ||
          (v.lang && v.lang.startsWith('en-US'))
        );
        if (selectedVoice) break;
      }
      
      // If no American voice found, try any English voice
      if (!selectedVoice) {
        selectedVoice = voices.find(v => v.lang && v.lang.startsWith('en'));
      }
      
      if (selectedVoice) {
        utterance.voice = selectedVoice;
      }
      
      // Force American English
      utterance.lang = 'en-US';
      
      const btn = document.getElementById('speakBtn');
      btn.classList.add('speaking');
      
      utterance.onend = () => {
        btn.classList.remove('speaking');
      };
      
      speechSynthesis.speak(utterance);
    }

    // Generate decoy letters
    function generateDecoys(word, count) {
      const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const wordLetters = new Set(word.split(''));
      const decoys = [];
      
      while (decoys.length < count) {
        const letter = alphabet[Math.floor(Math.random() * alphabet.length)];
        if (decoys.filter(d => d === letter).length < 2) {
          decoys.push(letter);
        }
      }
      
      return decoys;
    }

    // Shuffle array
    function shuffle(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Shuffle visible letters in the grid
    function shuffleLetters() {
      const grid = document.getElementById('lettersGrid');
      const letterEls = Array.from(grid.querySelectorAll('.falling-letter:not(.grabbed)'));
      
      // Shuffle the elements
      for (let i = letterEls.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        grid.insertBefore(letterEls[i], letterEls[j]);
      }
      
      // Add animation
      letterEls.forEach(el => {
        el.style.transform = 'scale(0.8)';
        setTimeout(() => {
          el.style.transform = '';
        }, 150);
      });
    }

    // Create rain effect
    function createRain() {
      const rain = document.getElementById('rain');
      for (let i = 0; i < 50; i++) {
        const drop = document.createElement('div');
        drop.className = 'rain-drop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
        drop.style.animationDelay = Math.random() * 2 + 's';
        rain.appendChild(drop);
      }
    }

    // Format time
    function formatTime(ms) {
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }

    // Update timer
    function updateTimer() {
      if (startTime) {
        const elapsed = Date.now() - startTime;
        document.getElementById('timer').textContent = formatTime(elapsed);
      }
    }

    // Show NPC reaction
    function showNpcReaction(type) {
      const reactions = npcs[type];
      const reaction = reactions[Math.floor(Math.random() * reactions.length)];
      
      const el = document.getElementById('npcReaction');
      document.getElementById('npcName').textContent = reaction.name;
      document.getElementById('npcMessage').textContent = `"${reaction.message}"`;
      document.getElementById('npcAvatar').innerHTML = `<use href="#${reaction.avatar}"/>`;
      
      el.classList.add('visible');
      
      setTimeout(() => {
        el.classList.remove('visible');
      }, 3000);
    }

    // Update progress dots
    function updateProgressDots() {
      const dots = document.querySelectorAll('.dot');
      dots.forEach((dot, i) => {
        dot.classList.remove('completed', 'current');
        if (i < currentWordIndex) {
          dot.classList.add('completed');
        } else if (i === currentWordIndex) {
          dot.classList.add('current');
        }
      });
    }

    // Create answer slots
    function createAnswerSlots(length) {
      const container = document.getElementById('answerSlots');
      container.innerHTML = '';
      answerLetters = new Array(length).fill(null);
      
      for (let i = 0; i < length; i++) {
        const slot = document.createElement('div');
        slot.className = 'answer-slot';
        slot.dataset.index = i;
        slot.onclick = () => removeFromSlot(i);
        container.appendChild(slot);
      }
    }

    // Create letters grid
    function createLettersGrid(word) {
      const grid = document.getElementById('lettersGrid');
      grid.innerHTML = '';
      discardedLetters = [];
      document.getElementById('discardedLetters').innerHTML = '';
      
      const decoyCount = 4;
      const wordLetters = word.split('');
      const decoys = generateDecoys(word, decoyCount);
      const allLetters = shuffle([...wordLetters, ...decoys]);
      
      fallingLetters = allLetters.map((letter, i) => ({
        letter,
        id: i,
        placed: false
      }));
      
      allLetters.forEach((letter, i) => {
        const el = document.createElement('div');
        el.className = 'falling-letter';
        el.textContent = letter;
        el.dataset.id = i;
        el.onclick = () => placeLetter(i);
        grid.appendChild(el);
      });
      
      updateCheckButton();
    }

    // Place letter in answer
    function placeLetter(id) {
      const letterData = fallingLetters[id];
      if (letterData.placed) return;
      
      const emptyIndex = answerLetters.findIndex(l => l === null);
      if (emptyIndex === -1) return;
      
      letterData.placed = true;
      answerLetters[emptyIndex] = letterData;
      
      const letterEl = document.querySelector(`.falling-letter[data-id="${id}"]`);
      letterEl.classList.add('grabbed');
      
      const slot = document.querySelectorAll('.answer-slot')[emptyIndex];
      slot.textContent = letterData.letter;
      slot.classList.add('filled');
      slot.classList.remove('correct', 'wrong-position', 'wrong');
      
      updateCheckButton();
    }

    // Place letter by character
    function placeLetterByChar(char) {
      const upperChar = char.toUpperCase();
      const letterData = fallingLetters.find(l => l.letter === upperChar && !l.placed);
      if (letterData) {
        placeLetter(letterData.id);
      }
    }

    // Remove letter from slot
    function removeFromSlot(index) {
      const letterData = answerLetters[index];
      if (!letterData) return;
      
      letterData.placed = false;
      answerLetters[index] = null;
      
      const letterEl = document.querySelector(`.falling-letter[data-id="${letterData.id}"]`);
      letterEl.classList.remove('grabbed');
      
      const slot = document.querySelectorAll('.answer-slot')[index];
      slot.textContent = '';
      slot.classList.remove('filled', 'correct', 'wrong-position', 'wrong');
      
      updateCheckButton();
    }

    // Remove last placed letter
    function removeLastLetter() {
      for (let i = answerLetters.length - 1; i >= 0; i--) {
        if (answerLetters[i] !== null) {
          removeFromSlot(i);
          break;
        }
      }
    }

    // Update check button state
    function updateCheckButton() {
      const btn = document.getElementById('checkBtn');
      const allFilled = answerLetters.every(l => l !== null);
      btn.disabled = !allFilled;
    }

    // Check answer
    function checkAnswer() {
      const guess = answerLetters.map(l => l.letter).join('');
      const target = currentWord.word;
      
      if (guess === target) {
        // Correct!
        gameResults.push('üü©'); // Track for sharing
        
        answerLetters.forEach((l, i) => {
          const slot = document.querySelectorAll('.answer-slot')[i];
          slot.classList.add('correct');
        });
        
        showNpcReaction('correct');
        
        setTimeout(() => {
          currentWordIndex++;
          if (currentWordIndex >= 5) {
            endGame();
          } else {
            loadWord();
          }
        }, 1500);
        
      } else {
        let hasClose = false;
        let hasWrong = false;
        
        answerLetters.forEach((letterData, i) => {
          const slot = document.querySelectorAll('.answer-slot')[i];
          
          if (letterData.letter === target[i]) {
            slot.classList.add('correct');
          } else if (target.includes(letterData.letter)) {
            slot.classList.add('wrong-position');
            hasClose = true;
          } else {
            slot.classList.add('wrong');
            hasWrong = true;
            
            setTimeout(() => {
              addToDiscarded(letterData);
              removeFromSlot(i);
            }, 500);
          }
        });
        
        showNpcReaction(hasClose ? 'close' : 'wrong');
      }
    }

    // Add letter to discarded
    function addToDiscarded(letterData) {
      if (discardedLetters.includes(letterData.id)) return;
      
      discardedLetters.push(letterData.id);
      
      const container = document.getElementById('discardedLetters');
      const el = document.createElement('div');
      el.className = 'discarded-letter';
      el.textContent = letterData.letter;
      el.onclick = () => retrieveFromDiscarded(letterData, el);
      container.appendChild(el);
      
      const gridEl = document.querySelector(`.falling-letter[data-id="${letterData.id}"]`);
      if (gridEl) {
        gridEl.style.display = 'none';
      }
    }

    // Retrieve from discarded
    function retrieveFromDiscarded(letterData, el) {
      const index = discardedLetters.indexOf(letterData.id);
      if (index > -1) {
        discardedLetters.splice(index, 1);
      }
      
      el.remove();
      letterData.placed = false;
      
      const gridEl = document.querySelector(`.falling-letter[data-id="${letterData.id}"]`);
      if (gridEl) {
        gridEl.style.display = 'flex';
        gridEl.classList.remove('grabbed');
      }
    }

    // Load current word
    function loadWord() {
      currentWord = currentPuzzle.words[currentWordIndex];
      
      document.getElementById('wordNum').textContent = currentWordIndex + 1;
      document.getElementById('hintText').textContent = `"${currentWord.hint}"`;
      document.getElementById('categoryBadge').textContent = currentPuzzle.category;
      
      createAnswerSlots(currentWord.word.length);
      createLettersGrid(currentWord.word);
      updateProgressDots();
      
      if (voiceEnabled) {
        setTimeout(speakHint, 500);
      }
    }

    // Start game
    function startGame() {
      document.getElementById('startOverlay').classList.add('hidden');
      
      currentPuzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
      currentWordIndex = 0;
      gameResults = []; // Reset results
      
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 100);
      gameStarted = true;
      
      if ('speechSynthesis' in window) {
        speechSynthesis.getVoices();
      }
      
      loadWord();
    }

    // End game
    function endGame() {
      clearInterval(timerInterval);
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
      }
      
      const elapsed = Date.now() - startTime;
      document.getElementById('finalTime').textContent = formatTime(elapsed);
      
      const victoryReaction = npcs.victory[Math.floor(Math.random() * npcs.victory.length)];
      document.getElementById('victoryMessage').textContent = `${victoryReaction.name}: "${victoryReaction.message}"`;
      
      document.getElementById('victoryOverlay').classList.add('visible');
    }

    // Restart game
    function restartGame() {
      document.getElementById('victoryOverlay').classList.remove('visible');
      
      currentWordIndex = 0;
      gameResults = [];
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 100);
      
      currentPuzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
      
      loadWord();
    }

    // Share results
    function shareResults() {
      const elapsed = Date.now() - startTime;
      const timeStr = formatTime(elapsed);
      
      const shareText = `‚òï Griddle Falls - Trivia Night

üèÜ Completed in ${document.getElementById('finalTime').textContent}!
${gameResults.join('')}

Play at griddlefalls.com

More games from the Letter Griddle Cafe:
ü•û lettergriddle.com
üåô littlelettergriddle.com
üçΩÔ∏è lettergriddlebuffet.com
üåÄ kerflufflegrid.com`;

      // Try to use native share if available
      if (navigator.share) {
        navigator.share({
          title: 'Griddle Falls',
          text: shareText
        }).catch(() => {
          // Fall back to clipboard
          copyToClipboard(shareText);
        });
      } else {
        copyToClipboard(shareText);
      }
    }

    // Copy to clipboard
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.getElementById('shareToast');
        toast.classList.add('visible');
        setTimeout(() => {
          toast.classList.remove('visible');
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }

    // Keyboard handler
    function handleKeydown(e) {
      if (!gameStarted) return;
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      
      const key = e.key;
      
      if (key === 'Backspace') {
        e.preventDefault();
        removeLastLetter();
      } else if (key === 'Enter') {
        e.preventDefault();
        const btn = document.getElementById('checkBtn');
        if (!btn.disabled) {
          checkAnswer();
        }
      } else if (/^[a-zA-Z]$/.test(key)) {
        e.preventDefault();
        placeLetterByChar(key);
      }
    }

    // Initialize
    createRain();
    document.addEventListener('keydown', handleKeydown);
    
    // Preload voices
    if ('speechSynthesis' in window) {
      speechSynthesis.onvoiceschanged = () => {
        speechSynthesis.getVoices();
      };
    }

    // ============ JUKEBOX ============
    const tracks = [
      { name: 'Sunday Vibes', file: 'audio/Sunday Vibes.mp3' },
      { name: 'Sunday Chillhop', file: 'audio/Sunday Chillhop.mp3' },
      { name: 'Sunday Jazz', file: 'audio/Sunday Jazz.mp3' },
      { name: 'Sunday Groove', file: 'audio/Sunday Groove.mp3' }
    ];

    let audioPlayer = null;
    let currentTrackIndex = 0;
    let isPlaying = false;

    // Initialize jukebox
    function initJukebox() {
      audioPlayer = new Audio();
      audioPlayer.loop = false;
      audioPlayer.volume = 0.5;
      
      // When track ends, play next
      audioPlayer.addEventListener('ended', () => {
        nextTrack();
        if (isPlaying) {
          audioPlayer.play();
        }
      });
      
      // Render playlist
      renderPlaylist();
      
      // Load saved preferences
      const savedVolume = localStorage.getItem('griddleFallsVolume');
      if (savedVolume) {
        audioPlayer.volume = parseFloat(savedVolume);
        document.getElementById('volumeSlider').value = parseFloat(savedVolume) * 100;
      }
    }

    // Render playlist
    function renderPlaylist() {
      const container = document.getElementById('playlist');
      container.innerHTML = '';
      
      tracks.forEach((track, index) => {
        const el = document.createElement('div');
        el.className = 'playlist-track' + (index === currentTrackIndex ? ' active' : '');
        el.innerHTML = `
          <span class="track-icon">üéµ</span>
          <span class="track-name">${track.name}</span>
          <span class="track-status">${index === currentTrackIndex && isPlaying ? 'Playing' : ''}</span>
        `;
        el.onclick = () => selectTrack(index);
        container.appendChild(el);
      });
    }

    // Select track
    function selectTrack(index) {
      currentTrackIndex = index;
      audioPlayer.src = tracks[index].file;
      document.getElementById('nowPlayingTrack').textContent = tracks[index].name;
      
      if (isPlaying) {
        audioPlayer.play().catch(e => console.log('Playback prevented:', e));
      }
      
      renderPlaylist();
    }

    // Toggle play/pause
    function togglePlay() {
      if (!audioPlayer.src || audioPlayer.src === '') {
        selectTrack(0);
      }
      
      if (isPlaying) {
        audioPlayer.pause();
        isPlaying = false;
        document.getElementById('playPauseBtn').textContent = '‚ñ∂';
        document.getElementById('jukeboxBtn').classList.remove('playing');
      } else {
        audioPlayer.play().then(() => {
          isPlaying = true;
          document.getElementById('playPauseBtn').textContent = '‚è∏';
          document.getElementById('jukeboxBtn').classList.add('playing');
        }).catch(e => console.log('Playback prevented:', e));
      }
      
      renderPlaylist();
    }

    // Next track
    function nextTrack() {
      currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
      selectTrack(currentTrackIndex);
    }

    // Previous track
    function prevTrack() {
      currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
      selectTrack(currentTrackIndex);
    }

    // Set volume
    function setVolume(value) {
      const vol = value / 100;
      audioPlayer.volume = vol;
      localStorage.setItem('griddleFallsVolume', vol.toString());
    }

    // Toggle jukebox modal
    function toggleJukebox() {
      const modal = document.getElementById('jukeboxModal');
      modal.classList.toggle('visible');
    }

    // Initialize jukebox on load
    initJukebox();

    // Set dynamic copyright year
    document.getElementById('copyrightYear').textContent = new Date().getFullYear();
  </script>
</body>
</html>
